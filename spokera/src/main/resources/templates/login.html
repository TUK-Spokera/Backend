<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인 및 로그아웃</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<!-- 카카오 로그인 버튼 -->
<div id="loginSection">
    <a href="/oauth2/authorization/kakao">
        <img src="/img/kakao_login_medium_narrow.png" alt="카카오 로그인 버튼">
    </a>
</div>

<!-- 로그아웃 버튼 -->
<div id="logoutSection" style="display: none;">
    <button id="logoutButton">로그아웃</button>
</div>

<script>
    // 페이지 로드 시 로그인 상태 확인
    document.addEventListener('DOMContentLoaded', function () {
        const token = localStorage.getItem('Authorization') || sessionStorage.getItem('Authorization');

        if (token) {
            // 로그인 상태일 경우
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('logoutSection').style.display = 'block';
            console.log('로그인 상태 확인: JWT 토큰 존재');
        } else {
            // 비로그인 상태일 경우
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('logoutSection').style.display = 'none';
            console.log('로그인 상태 확인: JWT 토큰 없음');
        }
    });

    // 로그아웃 버튼 클릭 이벤트
    document.getElementById('logoutButton').addEventListener('click', function () {
        logout();
    });

    // 로그아웃 함수
    function logout() {
        // 로컬 스토리지와 세션 스토리지에서 JWT 삭제
        const localTokenRemoved = localStorage.removeItem('Authorization');
        const sessionTokenRemoved = sessionStorage.removeItem('Authorization');

        // Authorization 헤더 제거
        delete axios.defaults.headers['Authorization'];

        // 확인 로그 출력
        console.log('로컬 스토리지에서 JWT 삭제:', localTokenRemoved);
        console.log('세션 스토리지에서 JWT 삭제:', sessionTokenRemoved);
        console.log('Axios Authorization 헤더 제거:', !axios.defaults.headers['Authorization']);

        // 서버에 로그아웃 요청
        fetch('/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: 'mh020805@gmail.com' // 실제 사용자 이메일을 입력
            })
        }).then(response => {
            if (response.ok) {
                console.log('로그아웃 성공');
                window.location.href = '/login?logout=true'; // 로그아웃 후 리다이렉트
            } else {
                console.error('로그아웃 실패');
            }
        }).catch(error => {
            console.error('서버 요청 중 오류 발생:', error);
        });
    }
</script>

</body>
</html>
